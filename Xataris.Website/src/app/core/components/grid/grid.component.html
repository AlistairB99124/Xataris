<div fxLayout="column" class="table-container">
    <table mat-table #table [dataSource]="dataSource" matSort class="mat-elevation-z8" style="max-height: 500px">
        <ng-container *ngFor="let column of gridOptions.columnDefs" matColumnDef="{{column.field}}">
            <!--Render Checkbox-->        
            <div *ngIf="column.columnType === 4">
                <th mat-header-cell *matHeaderCellDef class="checkbox">
                    <mat-checkbox style="margin-left: -17px" *ngIf="column.renderType === undefined" [(ngModel)]="allSelected" (change)="selectAll()"></mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let element" class="checkbox" [ngClass]="{'highlight-row': element.selected === true}">
                    <mat-checkbox *ngIf="column.renderType === undefined" [(ngModel)]="element.selected"></mat-checkbox>
                </td>
                <td mat-footer-cell *matFooterCellDef>{{getTotal(column)}}</td>
            </div>
            <!--Render Input-->
            <div *ngIf="column.columnType === 8">
                <th mat-header-cell *matHeaderCellDef><strong>{{column.title}}</strong></th>
                <td mat-cell *matCellDef="let element" [ngClass]="{'highlight-row': element.selected === true}">
                    <mat-form-field fxFlex>
                        <input matInput type="text" [(ngModel)]="element[column.field]" (change)="onInputChange(element)" *ngIf="column.renderType === 2">
                    </mat-form-field>
                </td>
                <td mat-footer-cell *matFooterCellDef><strong>{{getTotal(column)}}</strong></td>
            </div>
            <!--Render Button-->
            <div *ngIf="column.columnType === 5">
                <th mat-header-cell *matHeaderCellDef class="icon"></th>
                <td mat-cell *matCellDef="let element" class="icon" [ngClass]="{'highlight-row': element.selected === true}">
                    <button *ngIf="!column.actions && !column.actions.length" mat-button mat-icon-button (click)="column.onClick(element)">
                        <mat-icon *ngIf="column.iconName ? true : false" style="color: #039be5;">{{column.iconName}}</mat-icon>
                        <span style="color: rgba(139, 63, 139, 0.8)" *ngIf="column.iconName ? false : true">{{element[column.field]}}</span>
                    </button>
                    <button *ngIf="column.actions && column.actions.length" mat-button mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon *ngIf="column.iconName ? true : false" style="color: #039be5;">{{column.iconName}}</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button *ngFor="let action of column.actions" mat-menu-item (click)="action.onClick(element)">
                            <mat-icon>{{action.icon}}</mat-icon>
                            <span>{{action.label}}</span>
                        </button>
                    </mat-menu>
                </td>
                <td mat-footer-cell *matFooterCellDef><strong>{{getTotal(column)}}</strong></td>
            </div>
            <!--Render Readonly text-->
            <div *ngIf="column.columnType !== 4 || column.columnType !== 5">
                <th mat-header-cell *matHeaderCellDef class="text-left" style="position: relative">
                    <div fxLayout="row" fxLayoutAlign="start center">
                        <strong mat-sort-header fxFlex>{{column.title}}</strong>
                        <button *ngIf="gridOptions.idRow !== ''" mat-button mat-icon-button [matMenuTriggerFor]="menu" class="filter-button" (menuOpened)="onFilterClick(column)">
                            <mat-icon>menu</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <div fxLayout="row" (click)="$event.stopPropagation()"  style="margin-left: 10px; min-height: 40px;">
                                <input matInput type="text" 
                                placeholder="Search"
                                [(ngModel)]="filterText" 
                                (ngModelChange)="searchFilter($event)"/>
                            </div>
                            <ng-template matMenuContent>
                                <mat-divider></mat-divider>
                                <div fxLayout="row" mat-menu-item (click)="$event.stopPropagation();">
                                    <mat-checkbox [(ngModel)]="allFilteredSelected" (ngModelChange)="selectAllFiltered()"></mat-checkbox>
                                    <span style="margin-left: 10px" fxFlex>Select All</span>
                                </div>
                                <div fxLayout="row" mat-menu-item *ngFor="let option of filterOptionsFiltered" mat-menu-item (click)="$event.stopPropagation();">
                                    <mat-checkbox [(ngModel)]="option.selected" (ngModelChange)="setFilteredData()"></mat-checkbox>
                                    <span style="margin-left: 10px" fxFlex>{{option.field}}</span>
                                </div>
                            </ng-template>
                        </mat-menu>
                    </div>
                </th>
                <td mat-cell *matCellDef="let element" [ngClass]="{'highlight-row': element.selected === true}">
                    <div fxLayout="row" fxLayoutAlign="{{column.class === 'text-centre' ? 'center center' : column.class === 'text-right' ? 'end center' : 'start center'}}">
                        <span *ngIf="column.renderType === undefined">{{renderCell(element, column)}}</span>
                        <a *ngIf="column.renderType === 0" style="cursor: pointer; color: rgba(139, 63, 139, 1)" (click)="column.onClick(element)">{{renderCell(element, column)}}</a>
                    </div>
                </td>
                <td mat-footer-cell *matFooterCellDef><strong [ngStyle]="{'float': column.columnType === 1 || column.columnType === 2 ? 'right' : ''}">{{getTotal(column)}}</strong></td>
            </div>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="shownColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: shownColumns;"></tr>
        <div *ngIf="gridOptions.showFooter">
            <tr mat-footer-row *matFooterRowDef="shownColumns; sticky: true"></tr>
        </div>
    </table>
    <!--<mat-paginator [pageSizeOptions]="[5, 10]" showFirstLastButtons></mat-paginator>-->
</div>